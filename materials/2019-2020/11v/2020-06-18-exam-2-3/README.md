# Сноуборд сезон

Ще разработим софтуер за продажба на сноуборд/ски карти в зимен курорт.

В нашата система

* се използва каса (гише, терминал), където се продават карти;
* пистите имат максимален капацитет от 1000 сноубордисти, т.е. в едновременно
обращение не може да има повече от 1000 карти. При опит да се купят повече
карти, трябва да се хвърли `java.lang.IllegalStateException`;
* всяка каса пази данните за всички издадени карти - име на ползвател и дата/час
на издаване.

Възможните операции на каса са

* закупуване на карта - цената на картата е 50лв и 1лв депозит;
* връщане на карта - възстановява се депозитът на притежателя ѝ.

Сноубордистите са конкурентни потребители на системата, които се характеризират
с име и всеки от тях има следния "жизнен цикъл":

1. закупува си карта;
2. използва я определено време (между 100 и 500 милисекунди - ще го симулираме,
използвайки `Thread.sleep()`);
3. връща я на касата.

## Задача 1

Дефинирайте класа `CashDesk`, който представя касата, от която ще се купуват
картите.

```java
public class CashDesk {
    private static final int MAX_CARDS = 1000;
    private static final int CARD_PRICE = 50;
    private static final int DEPOSIT = 1;

    /**
     * Gives a card to a snowboarder. The snowboarder pays CARD_PRICE + DEPOSIT.
     */
    public void buyCard(Snowboarder snowboarder) {
    }

    /**
     * Returns the deposit to a snowboarder.
     */
    public void returnCard(Snowboarder snowboarder) {
    }

    /**
     * Returns the cash amount currently contained in this cash desk.
     */
    public int getAmount() {
    }

    /**
     * Returns the maximum number of available cards in this cash desk.
     */
    public int getMaxAvailableCardsCount() {
    }

    /**
     * Returns the number of sold cards.
     */
    public int getSoldCardsCount() {
    }

    /**
     * Returns the number of available cards currently contained in this cash
     * desk.
     */
    public int getAvailableCardsCount() {
    }
}
```

Дефинирайте класа `Snowboarder`, представящ сноубордиста в нашата система. Тъй
като сноубордистите са конкурентни потребители на системата (конкурират се за
купуване на карта от касата), класът `Snowboarder` трябва да е нишка.

```java
public class Snowboarder extends Thread {
    private final CashDesk cashDesk;

    public Snowboarder(String name, CashDesk cashDesk) {
    }

    @Override
    public void run() {
    }
}
```

Създайте и пуснете конкурентно `n` на брой сноубордисти. След приключване на
работния ден (жизнения цикъл на всички сноубордисти), изведете броя карти в
наличност и баланса на касата. Подсигурете, че балансът в края на работния ден е
коректен (равен на броя продадени карти х 50лв) и броят на картите в наличност е
равен на първоначалния.

## Задача 2

Ако на курорта отидат повече сноубордисти от максималния капацитет на пистите,
вместо да се хвърля изключение при изчерпване на максималния брой карти,
сноубордистите изчакват на касата и при връщане/освобождаване на карта,
неуспелите да си закупят карта от първия път ще бъдат автоматично известени.

## Задача 3

Стартирайте сноубордистите чрез подходящ thread pool. Изберете такъв thread
pool, че да няма нужда от допълнителна комуникация между нишките в ситуациите,
когато са изчерпани всички карти. Подсигурете, че приложението ще приключи
своята работа след като последният сноубордист си върне картата.

## Задача 4

В отделна нишка, на определен фиксиран интервал от време (например 50
милисекунди) извеждайте на стандартния изход информация за наличността в касата
и броя раздадени (активни в момента) карти.
